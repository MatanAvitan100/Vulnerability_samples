#include <stdio.h>
#include <string.h>
#include <stdlib.h>

// CWE-124: Buffer Underwrite ('Buffer Underflow')
// https://cwe.mitre.org/data/definitions/124.html

char* trimTrailingWhitespace(char *strMessage, int length) 
{
	char *retMessage;
	char *message = malloc(sizeof(char)*(length+1));

	// copy input string to a temporary string
	// char message[length+1];
	int index;

	for (index = 0; index < length; index++) 
	{
		message[index] = strMessage[index];
	}

	message[index] = '\0';

	// trim trailing whitespace
	int len = index-1;
	while (isspace(message[len])) 
	{
		message[len] = '\0';
		len--;
	}

	// return string without trailing whitespace
	retMessage = message;
	return retMessage;
}

int main(int argc, char *argv[])
{	
	trimTrailingWhitespace(argv[1], strlen(argv[1]));
	return 0;
}
